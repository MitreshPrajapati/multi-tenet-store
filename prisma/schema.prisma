// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
  FARMER
  MODERATOR
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELED
}

model Coupon {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  couponCode String
  percent    Int
  isActive   Boolean

  expiryDate DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Banner {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  bannerLink String
  imageUrl   String
  isActive   Boolean

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  slug        String  @unique
  imageUrl    String?
  description String?
  isActive    Boolean

  products  Product[]
  trainings Training[]

  marketIds String[] @db.ObjectId
  markets   Market[] @relation(fields: [marketIds], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Market {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  slug        String  @unique
  title       String
  description String
  logoUrl     String
  isActive    Boolean

  categoryIds String[]   @db.ObjectId
  categories  Category[] @relation(fields: [categoryIds], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Product {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  title             String
  slug              String   @unique
  description       String
  imageUrl          String?
  isActive          Boolean
  sku               String?
  barcode           String?
  productCode       String?
  unit              String?
  productPrice      Float
  salePrice         Float
  isWholesale       Boolean
  wholesalePrice    Float
  wholesaleQuantity Int
  productStock      Int
  quantity          Int
  tags              String[]

  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  categoryId String   @db.ObjectId

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @db.ObjectId

  orderItems OrderItem[]
  sales      Sale[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime?   @updatedAt
}

model Training {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  slug        String  @unique
  imageUrl    String?
  description String?
  content     String?
  isActive    Boolean

  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId String    @db.ObjectId

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model User {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  name          String?
  email         String? @unique
  password      String
  emailVerified Boolean @default(false)

  products Product[]
  role     UserRole  @default(USER)

  farmerProfile FarmerProfile?

  verificationToken String?
  profile           UserProfile?
  orders            Order[]
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  // userProfileId     String?      @db.ObjectId
  sales             Sale[]
}

model UserProfile {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  userId      String    @unique @db.ObjectId
  dateOfBirth DateTime?
  address     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model FarmerProfile {
  id              String  @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  phone           String
  email           String
  farmerCode      String
  profileImageUrl String?
  isActive        Boolean

  physicalAddress    String?
  contactPerson      String?
  contactPersonPhone String?
  paymentTerms       String?
  notes              String?

  products String[]
  mainCrop String
  landSize Float

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  orderNumber String

  userId    String @db.ObjectId
  firstName String
  lastName  String
  email     String
  phone     String

  streetAddress String
  city          String
  country       String
  zipcode       String

  shippingCost  Float
  paymentMethod String

  orderItems  OrderItem[]
  orderStatus OrderStatus @default(PROCESSING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User   @relation(fields: [userId], references: [id])
  // orderItemId String      @db.ObjectId
  sales Sale[]
}

model OrderItem {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  orderId   String @db.ObjectId
  productId String @db.ObjectId
  vendorId  String @db.ObjectId

  quantity Int
  price    Float
  title    String
  imageUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

model Sale {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  orderId   String @db.ObjectId
  productId String @db.ObjectId
  vendorId  String @db.ObjectId

  productTitle    String
  productImage    String
  productPrice    Float
  productQuantity Int

  total     Float
  date      DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
  vendor  User    @relation(fields: [vendorId], references: [id])
}
